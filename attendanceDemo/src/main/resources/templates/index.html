<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Class</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet"  type="text/css"  href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <link rel="stylesheet"  type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
</head>
<body>
<span id="date" style="float: right"></span>

<div class="container">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            <div class="card">
                <div class="card-body">
                    <h3>Attendance</h3><br>

                    <form>

                        <div class="input-group mb-3">
                            <label for="studentClass" class="form-label">Enter Class</label>
                            <input type="number" id="studentClass" name="studentClass" class="form-control" value="" style="margin: 0 20px"/>
                            <label for="section" class="form-label">Enter Section</label>
                            <input type="text" class="form-control" id="section" name="section" value="" style="margin: 0 20px" />
                            <button id="markAttendance" class="btn btn-primary">Mark Attendance</button>
                        </div>

                        <div class="input-group mb-3">
                            <label for="fromDate" class="form-label">From Date</label>
                            <input type="date" id="fromDate" name="studentClass" class="form-control" value="" style="margin: 0 20px"/>
                            <label for="toDate" class="form-label">To Date</label>
                            <input type="date" class="form-control" id="toDate" name="section" value="" style="margin: 0 20px" />
                            <button id="getDetails" class="btn btn-primary">Get Details</button>
                        </div>

                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    </form>
                </div>
            </div>
        </div>

        <div id="attendanceTable"></div>

        <div id="studentDetails"></div>
    </div>
</div>
<script>
    let date = new Date().toDateString();
    document.getElementById("date").innerHTML = date;

    $('#markAttendance').click(function (e){
        e.preventDefault();
        let studentClass = $('#studentClass').val();
        let section = $('#section').val();

        if(studentClass && section){
            $.get('/attendance', {'studentClass': studentClass, 'section': section}, function (data, status){
                $('#attendanceTable').html(unescape(data));
            });
        } else{
            alert("Please enter appropriate class and section")
        }
    })

    $('#getDetails').click(function (e){
        e.preventDefault();
        let studentClass = $('#studentClass').val();
        let section = $('#section').val();
        let fromDate = $('#fromDate').val();
        let toDate = $('#toDate').val();

        if(fromDate && studentClass && section){
            if(!toDate){
                toDate = new Date();
            }
            $.get('/records', {'studentClass': studentClass, 'section': section, 'fromDate': fromDate.toString(), 'toDate': toDate.toString()}, function (data, status){
                $('#attendanceTable').html(unescape(data));
            });
        } else{
            alert("Please enter appropriate class, section and from Date")
        }
    })

</script>
</body>
</html>